{% extends "base.html" %}

{% block content %}
    <h1>Today's articles &times;{{ count }} (total &times;{{ dbcount }})</h1>
    <h2 class="today" style="background-color: #{{ color(overall, [-10, 10]) }};">Today's Sentiment: {{ overall }}%</h2>
    {% if running %}
    <h2>Running spiders:</h2>
    <ul>
    {% for job in running %}
        <li>{{ job['spider'] }}</li>
    {% endfor %}
    </ul>
    {% endif %}
    <div class="pagination">
        Sort by:
        {% for s in sorts %}
            <a {% if sort==s %}class="active"{% endif %} style="margin-left: 1rem;" href="{{ url_for('index', sort=s) }}">{{ s }}</a>
        {% endfor %}
    </div>
    <div class="pagination">
        Pages:
        {% for p in pages %}
            <a href="{{ url_for('index', page=p, sort=sort) }}" {% if page == p %}class="active"{% endif %}>{{ p }}</a>
        {% endfor %}
    </div>
    <p>key: [ <b>sentiment</b> (positive minus negative), <b>neutrality</b>, <b>compound</b> ]</p>
    {% for agency in agencies %}
        <h1 style="margin-top: 3rem; margin-bottom: 2rem;">
            <a href="{{ url_for("agency", agency=agency.name) }}">
                <span class="agencyname" style="background-color: #{{
                    color(clamp(agency.todays_sentiment, -10, 10), [-10,10])
                    }}">{{ agency.name.upper() }}</span>
            </a>
            today &times;{{ agency.todays_count }}
            [
            <span style="color: #{{ color(agency.todays_sentiment) }}">{{ agency.todays_sentiment }}%</span>,
            <span style="color: #{{ color(clamp(agency.todays_neutrality, 70,100), [70,100], color1='808080', color2='0000FF') }}">{{ agency.todays_neutrality }}%</span>
            ]
        </h1>
        <ol style="list-style-type: none;">
            {% for article in agency.todays_articles %}
                <li style="margin: 1rem">
                    <a style="padding: 0.25rem; color: white; background-color: #{{ article.color }}" href="{{ article.url }}">{{ article.title }}</a>
                    [
                    <span style="color: #{{ article.color }}">{{ article.sentiment }}%</span>,
                    <span style="color: #{{ article.neutrality_color }}">{{ article.neutrality }}%</span>,
                    <span style="color: #{{ article.compound_color }}">{{ article.comp }}%</span>
                    ]
                </li>
            {% endfor %}
        </ol>
    {% endfor %}
    <div class="pagination">
        Pages:
        {% for p in pages %}
            <a href="{{ url_for('index', page=p, sort=sort) }}" {% if page == p %}class="active"{% endif %}>{{ p }}</a>
        {% endfor %}
    </div>
{% endblock %}
